//created on: May 15, 2020
package integracija

//list any import classes here.
import events.TransactionEvent;
import events.MembershipExpiredEvent;
import events.BookLoanExpiredEvent;
import events.BookLoanMade;
//declare any global variables here

declare MembershipPaid
	@role(event)
    userId: Long
end

declare BookLoanEvent
	@role(event)
    userId: Long
    bookLoanId: Long
end

rule "Membership-expired"
    when
    	MembershipPaid($uId: userId)
    	//MembershipPaid(userId == $uId)
        not(
            //$t1:TransactionEvent($uId: userId) 
            MembershipPaid(userId == $uId)
            over window:time(10s)
        )
    then
        System.out.println("expired__________________________________________________________________" );
        insert(new MembershipExpiredEvent($uId));
        drools.halt();
end

rule "Membership-paid"
    when
    	$t1:TransactionEvent($uId: userId) 
    then
        System.out.println("paid__________________________________________________________________" + $uId );
        insert(new MembershipPaid($uId));
end

rule "BookLoan-expired"
    when
    	BookLoanEvent($uId: userId, $bId: bookLoanId)
        not(
            BookLoanMade(userId == $uId, bookLoanId == $bId)
            over window:time(10s)
        )
    then
        System.out.println("book loan expired__________________________________________________________________" );
        insert(new BookLoanExpiredEvent($uId, $bId));
        drools.halt();
end

rule "BookLoan-made"
    when
    	$e1:BookLoanMade($uId: userId, $bId: bookLoanId) 
    then
        System.out.println("made book loan__________________________________________________________________" + $uId );
        insert(new BookLoanEvent($uId, $bId));
end